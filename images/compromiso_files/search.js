/*! tineye 2015-08-20 */
function toggleDisclosureWidget(e){var t=document.getElementById(e);t.className="slide-show"==t.className?"slide-hide":"slide-show"}function gotopage(e){""!=e&&(self.location=e)}function overlay(e,t,i){close_open_overlay(),$("#overlay-"+t+i).children().remove();var n='<div class="toggle"><div id="your_image_label-'+t+'" class="nonactive yourimage"><h4><a class="toggle_images-'+t+'">Your image</a></h4></div>';n+='<div class="switch switch-active-right"><input name="search_button" value="Switch" class="button toggle_images-'+t+'" type="submit" /></div>',n+='<div id="matching_image_label-'+t+'" class="active-right imagematch"><h4><a class="toggle_images-'+t+'">Image match</a></h4></div></div>';var r='<div class="overlay-container"><div class="images overlay" id="overlay_image-'+t+'"><div id="matching_image-'+t+'" class="active"></div></div><div id="your_image-'+t+'" ></div></div>';$("#overlay-"+t+i).append(n).append(r);var o=new Image;$(o).bind("load",function(){var n=o.width,r=o.height,a=$(".overlay-container").width()-20;n>2*a&&(r=Math.round(2*a/n*r),n=2*a),$(document).bind("keydown",function(e){var r=e.which?e.which:e.keyCode;39==r||63235==r?show_match_image(t):37==r||63234==r?show_your_image(n,t):27==r&&close_overlay(t+i)}),toggle_box=$(".toggle_images-"+t),toggle_box.click(function(){$("#matching_image-"+t).hasClass("active")?show_your_image(n,t):show_match_image(t)});var s=$("#overlay_image-"+t);s.css("width",n/2+"px"),s.css("height",r+"px"),s.css("margin","10px auto 10px"),s.css("background-position","0px center"),s.css("background-size",n+"px "+r+"px"),s.css("background-image","url('"+e+"')")}),o.src=e,open_overlay=t+i,$(".results").off("click",close_open_overlay).on("click",close_open_overlay),$(".compare-popup").off("click",function(e){e.stopPropagation()}).on("click",function(e){e.stopPropagation()})}function close_open_overlay(){null!==open_overlay&&close_overlay(open_overlay)}function close_overlay(e){toggleDisclosureWidget("compare-"+e),$("#overlay-"+e).children().remove(),$(document).unbind("keydown"),open_overlay=null,$(".results").off("click",close_open_overlay),$(".compare-popup").off("click",function(e){e.stopPropagation()})}function show_your_image(e,t){$("#overlay_image-"+t).css("background-position",-(e/2)+"px center"),$("#your_image_label-"+t).removeClass("nonactive"),$("#matching_image_label-"+t).removeClass("active-right"),$("#your_image_label-"+t).addClass("active-left"),$("#matching_image_label-"+t).addClass("nonactive"),$("#matching_image-"+t).removeClass("active"),$("#your_image-"+t).addClass("active"),$(".switch").removeClass("switch-active-right"),$(".switch").addClass("switch-active-left")}function show_match_image(e){$("#overlay_image-"+e).css("background-position","0px center"),$("#your_image_label-"+e).removeClass("active-left"),$("#matching_image_label-"+e).removeClass("nonactive"),$("#your_image_label-"+e).addClass("nonactive"),$("#matching_image_label-"+e).addClass("active-right"),$("#your_image-"+e).removeClass("active"),$("#matching_image-"+e).addClass("active"),$(".switch").removeClass("switch-active-left"),$(".switch").addClass("switch-active-right")}function exit(e,t,i,n){if(document.images){var r=encodeURIComponent||escape;(new Image).src="/exit?type="+i+"&pos="+n+"&key="+t+"&url="+r(e.replace(/#.*/,"")).replace(/\+/g,"%2B")}return!0}function toggle_link_to_search(){$("#link_to_search_url").toggle(),$("#link_to_search").toggle()}function progress_handler(){display_throbber()}function display_throbber(){window.operamini||($("#url_box")[0].setAttribute("readonly","readonly"),$("#url_submit")[0].disabled=!0)}function hide_throbber(){$("#throbber").hide(),window.operamini||$("#url_box")[0].removeAttribute("readonly")}function handle_opera_mini(){return window.operamini?($("#upload-button").addClass("old-search"),$("#upload-button").text("Choose an image"),$("#upload-button").addClass("old-search"),$("#upload_box").addClass("old-search"),$("#file_submit").show(),$(".input-container").addClass("old-search"),$("#url_box").attr("placeholder","Or enter an image URL"),$(".forms").addClass("old-forms"),$(".forms a").hide(),$(".forms #browser").hide(),$(".ads").hide(),$("#google_ads_div_index_page_ad_wrapper").hide(),!0):!1}function drag_and_drop(e){if(!handle_opera_mini()){var t={url:e,formData:[{name:"json",value:"True"}],dataType:"json",done:function(e,t){t.result.error?alert(t.result.error):window.location=t.result.redirect_link},start:function(){$("#upload_overlay_message").show()},always:function(){$("body").removeClass("dragenter"),$("#upload_overlay_message").hide()},dropZone:$("#upload_overlay")};$("#upload_box_drag").fileupload(t),$("body").on("dragenter",function(e){e.originalEvent.stopPropagation(),e.originalEvent.preventDefault(),$("body").addClass("dragenter")}),$("#upload_overlay").on("dragover dragleave dragenter",function(e){e.stopPropagation(),e.preventDefault()}),$("#upload_overlay").on("drop",function(e){if(e.originalEvent.preventDefault(),!e.originalEvent.dataTransfer.files.length){var t=e.originalEvent.dataTransfer.getData("text/html");if(t){var i=$(t),n=i.attr("src");return n||(n=i.find("img").attr("src")),n||(n=i.filter("img").attr("src")),n?($("#url_box_drag").val(n),$("#url_form_drag").submit(),$("#upload_overlay").show(),$("#upload_overlay_message").show()):t&&$("body").removeClass("dragenter"),void 0}var t=e.originalEvent.dataTransfer.getData("text/plain");return t?($("#url_box_drag").val(t),$("#url_form_drag").submit(),$("#upload_overlay").show(),$("#upload_overlay_message").show(),void 0):($("body").removeClass("dragenter"),void 0)}}),$("#upload_overlay").on("dragleave",function(e){e.originalEvent.stopPropagation(),e.originalEvent.preventDefault(),$("body").removeClass("dragenter")})}}function change_sort_filter(e,t,i){var n={};e&&(n.domain=e),t&&(n.sort=t),i&&(n.order=i),window.location.search="?"+$.param(n)}function get_collection_domains(e,t,i,n){$.ajax({url:"/search/get_collection_domains/"+e,dataType:"json"}).done(function(e){if($("#collections").empty(),e.domains.length){$.each(e.domains,function(e,r){var o=r[0],a=r[1],s=$("<li />"),l=$("<input />",{type:"radio",id:o+"-cb","class":"radio",value:o}).appendTo(s),p=$("<label />",{"for":o+"-cb","class":"radio",text:o+" ("+a+")",onclick:""}).appendTo(s);$("<span></span>").prependTo(p),o==t&&(l=l.prop("checked","checked"),p.addClass("active")),l.on("click",function(){var e=$(this).attr("id");$("input.radio").each(function(){$(this).attr("id")!=e&&$(this).prop("checked",!1)}),$(this).prop("checked")?change_sort_filter($(this).val(),i,n):change_sort_filter("",i,n)}),$("#collections").append(s)}),e.domains.length>1&&$("#collection-count").text("There are "+e.domains.length+" collections to filter on.");var r=$(".clear_collections");r.on("click",function(){change_sort_filter("",i,n)}),$(".filters").show(),""!==t&&$(".clear_collections").addClass("visible")}window.operamini||$(".ads").show()})}function handle_JSON_action_response(){}function plugin_download(e,t){$.post("/plugins",{plugin:e,version:t},handle_JSON_action_response,"json")}function get_browser(){var e=navigator.userAgent.toLowerCase();return/(iphone|ipad|ipod|android|blackberry|windows phone)/.test(e)?"":/opr/.test(e)?"opera":/crmo/.test(e)||/crios/.test(e)?"chrome":/chrome/.test(e)?"chrome":/safari/.test(e)?"safari":/msie/.test(e)||/trident/.test(e)?"msie":/mozilla/.test(e)?"mozilla":""}function show_plugins(){""===get_browser()&&($(".plugins-container div").hide(),$(".highlights .col-sm-4").prop("class","col-xs-12 col-sm-6")),$(".highlights").show()}function display_extension_link(){var e=get_browser();"mozilla"===e?($("#firefox").show(),$("#browser").html("for Firefox")):"chrome"===e?($("#chrome").show(),$("#browser").html("for Chrome")):"safari"===e?($("#safari").show(),$("#browser").html("for Safari")):"msie"===e?($("#msie").show(),$("#browser").html("for Internet Explorer")):"opera"===e?($("#opera").show(),$("#browser").html("for Opera")):$("#browser").hide()}function detect_browser_search_page(){var e=get_browser(),t="firefox";"mozilla"==e||""==e?$("#extension-name").html("the official TinEye extension for Firefox with right-click functionality"):"chrome"==e?($("#extension-name").html("the official TinEye extension for Chrome with right-click functionality"),t="chrome"):"msie"==e?($("#extension-name").html("the official TinEye extension for Internet Explorer with right-click functionality"),t="internet-explorer"):"safari"==e?($("#extension-name").html("the official TinEye extension for Safari with right-click functionality"),t="safari"):"opera"==e&&($("#extension-name").html("the official TinEye extension for Opera"),t="opera"),$(".plugin-alert").attr("class","plugin-alert "+t)}function detect_browser_plugin_page(){var e=get_browser();"chrome"==e?show_plugin("chrome"):"msie"==e?show_plugin("ie"):"safari"==e?show_plugin("safari"):"opera"==e?show_plugin("opera"):("mozilla"==e||""==e)&&show_plugin("firefox")}function show_plugin(e){$("#firefox-container").hide(),$("#chrome-container").hide(),$("#ie-container").hide(),$("#safari-container").hide(),$("#opera-container").hide(),$("#"+e+"-container").show()}function switch_plugin_icon(){var e=get_browser(),t="firefox";"chrome"==e?t="chrome":"msie"==e?t="internet-explorer":"safari"==e?t="safari":"opera"==e&&(t="opera"),$("#plugin-icon").attr("class",t)}function show_drag_and_drop(){var e=get_browser();("chrome"==e||"safari"==e||"mozilla"==e)&&$(".drag-and-drop").show()}var open_overlay=null;jQuery.preloadImages=function(){for(var e=0;arguments.length>e;e++)jQuery("<img>").attr("src",arguments[e])},$.preloadImages("/images/throbber.gif"),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e,t){var i=0,n=Array.prototype.slice,r=e.cleanData;e.cleanData=function(t){for(var i,n=0;null!=(i=t[n]);n++)try{e(i).triggerHandler("remove")}catch(o){}r(t)},e.widget=function(i,n,r){var o,a,s,l,p={},u=i.split(".")[0];i=i.split(".")[1],o=u+"-"+i,r||(r=n,n=e.Widget),e.expr[":"][o.toLowerCase()]=function(t){return!!e.data(t,o)},e[u]=e[u]||{},a=e[u][i],s=e[u][i]=function(e,i){return this._createWidget?(arguments.length&&this._createWidget(e,i),t):new s(e,i)},e.extend(s,a,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),l=new n,l.options=e.widget.extend({},l.options),e.each(r,function(i,r){return e.isFunction(r)?(p[i]=function(){var e=function(){return n.prototype[i].apply(this,arguments)},t=function(e){return n.prototype[i].apply(this,e)};return function(){var i,n=this._super,o=this._superApply;return this._super=e,this._superApply=t,i=r.apply(this,arguments),this._super=n,this._superApply=o,i}}(),t):(p[i]=r,t)}),s.prototype=e.widget.extend(l,{widgetEventPrefix:a?l.widgetEventPrefix||i:i},p,{constructor:s,namespace:u,widgetName:i,widgetFullName:o}),a?(e.each(a._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,s,i._proto)}),delete a._childConstructors):n._childConstructors.push(s),e.widget.bridge(i,s)},e.widget.extend=function(i){for(var r,o,a=n.call(arguments,1),s=0,l=a.length;l>s;s++)for(r in a[s])o=a[s][r],a[s].hasOwnProperty(r)&&o!==t&&(i[r]=e.isPlainObject(o)?e.isPlainObject(i[r])?e.widget.extend({},i[r],o):e.widget.extend({},o):o);return i},e.widget.bridge=function(i,r){var o=r.prototype.widgetFullName||i;e.fn[i]=function(a){var s="string"==typeof a,l=n.call(arguments,1),p=this;return a=!s&&l.length?e.widget.extend.apply(null,[a].concat(l)):a,s?this.each(function(){var n,r=e.data(this,o);return r?e.isFunction(r[a])&&"_"!==a.charAt(0)?(n=r[a].apply(r,l),n!==r&&n!==t?(p=n&&n.jquery?p.pushStack(n.get()):n,!1):t):e.error("no such method '"+a+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+a+"'")}):this.each(function(){var t=e.data(this,o);t?t.option(a||{})._init():e.data(this,o,new r(a,this))}),p}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,n){var r,o,a,s=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(s={},r=i.split("."),i=r.shift(),r.length){for(o=s[i]=e.widget.extend({},this.options[i]),a=0;r.length-1>a;a++)o[r[a]]=o[r[a]]||{},o=o[r[a]];if(i=r.pop(),1===arguments.length)return o[i]===t?null:o[i];o[i]=n}else{if(1===arguments.length)return this.options[i]===t?null:this.options[i];s[i]=n}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(i,n,r){var o,a=this;"boolean"!=typeof i&&(r=n,n=i,i=!1),r?(n=o=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,o=this.widget()),e.each(r,function(r,s){function l(){return i||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?a[s]:s).apply(a,arguments):t}"string"!=typeof s&&(l.guid=s.guid=s.guid||l.guid||e.guid++);var p=r.match(/^(\w+)\s*(.*)$/),u=p[1]+a.eventNamespace,d=p[2];d?o.delegate(d,u,l):n.bind(u,l)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,n){var r,o,a=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(r in o)r in i||(i[r]=o[r]);return this.element.trigger(i,n),!(e.isFunction(a)&&a.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,r,o){"string"==typeof r&&(r={effect:r});var a,s=r?r===!0||"number"==typeof r?i:r.effect||i:t;r=r||{},"number"==typeof r&&(r={duration:r}),a=!e.isEmptyObject(r),r.complete=o,r.delay&&n.delay(r.delay),a&&e.effects&&e.effects.effect[s]?n[t](r):s!==t&&n[s]?n[s](r.duration,r.easing,o):n.queue(function(i){e(this)[t](),o&&o.call(n[0]),i()})}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(e){"use strict";var t=0;e.ajaxTransport("iframe",function(i){if(i.async){var n,r,o,a=i.initialIframeSrc||"javascript:false;";return{send:function(s,l){n=e('<form style="display:none;"></form>'),n.attr("accept-charset",i.formAcceptCharset),o=/\?/.test(i.url)?"&":"?","DELETE"===i.type?(i.url=i.url+o+"_method=DELETE",i.type="POST"):"PUT"===i.type?(i.url=i.url+o+"_method=PUT",i.type="POST"):"PATCH"===i.type&&(i.url=i.url+o+"_method=PATCH",i.type="POST"),t+=1,r=e('<iframe src="'+a+'" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,o=e.isArray(i.paramName)?i.paramName:[i.paramName];r.unbind("load").bind("load",function(){var t;try{if(t=r.contents(),!t.length||!t[0].firstChild)throw Error()}catch(i){t=void 0}l(200,"success",{iframe:t}),e('<iframe src="'+a+'"></iframe>').appendTo(n),window.setTimeout(function(){n.remove()},0)}),n.prop("target",r.prop("name")).prop("action",i.url).prop("method",i.type),i.formData&&e.each(i.formData,function(t,i){e('<input type="hidden"/>').prop("name",i.name).val(i.value).appendTo(n)}),i.fileInput&&i.fileInput.length&&"POST"===i.type&&(t=i.fileInput.clone(),i.fileInput.after(function(e){return t[e]}),i.paramName&&i.fileInput.each(function(t){e(this).prop("name",o[t]||i.paramName)}),n.append(i.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),i.fileInput.removeAttr("form")),n.submit(),t&&t.length&&i.fileInput.each(function(i,n){var r=e(t[i]);e(n).prop("name",r.prop("name")).attr("form",r.attr("form")),r.replaceWith(n)})}),n.append(r).appendTo(document.body)},abort:function(){r&&r.unbind("load").prop("src",a),n&&n.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var i=t&&t[0];return i&&e.isXMLDoc(i)?i:e.parseXML(i.XMLDocument&&i.XMLDocument.xml||e(i.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)}(function(e){"use strict";e.support.fileInput=!(RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file">').prop("disabled")),e.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:e(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||""+t,i&&e.each(i,function(e,i){t=t.replace("{"+e+"}",i)}),t},formData:function(e){return e.serializeArray()},add:function(t,i){return t.isDefaultPrevented()?!1:((i.autoUpload||i.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()}),void 0)},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return(!this.bitrate||!i||n>i)&&(this.bitrate=8*(t-this.loaded)*(1e3/n),this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return"function"===e.type(t.formData)?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(i=[],e.each(t.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(t){var i=0;return e.each(t,function(e,t){i+=t.size||1}),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,i):t._progress=i},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,i){if(t.lengthComputable){var n,r=Date.now?Date.now():(new Date).getTime();if(i._time&&i.progressInterval&&r-i._time<i.progressInterval&&t.loaded!==t.total)return;i._time=r,n=Math.floor(t.loaded/t.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0),this._progress.loaded+=n-i._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,i.bitrateInterval),i._progress.loaded=i.loaded=n,i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(r,n,i.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),i),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var i=this,n=t.xhr?t.xhr():e.ajaxSettings.xhr();n.upload&&(e(n.upload).bind("progress",function(e){var n=e.originalEvent;e.lengthComputable=n.lengthComputable,e.loaded=n.loaded,e.total=n.total,i._onProgress(e,t)}),t.xhr=function(){return n})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var i,n=this,r=t.files[0],o=t.multipart||!e.support.xhrFileUpload,a="array"===e.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),o&&!t.blob&&this._isInstanceOf("File",r)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"'),o?e.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:a,value:t.blob}):e.each(t.files,function(n,r){i.push({name:"array"===e.type(t.paramName)&&t.paramName[n]||a,value:r})})):(n._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,e.each(this._getFormData(t),function(e,t){i.append(t.name,t.value)})),t.blob?i.append(a,t.blob,r.name):e.each(t.files,function(r,o){(n._isInstanceOf("File",o)||n._isInstanceOf("Blob",o))&&i.append("array"===e.type(t.paramName)&&t.paramName[r]||a,o,o.uploadName||o.name)})),t.data=i):(t.contentType=r.type||"application/octet-stream",t.data=t.blob||r),t.blob=null},_initIframeSettings:function(t){var i=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&i&&i!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var i=e(t.fileInput),n=t.paramName;return n?e.isArray(n)||(n=[n]):(n=[],i.each(function(){for(var t=e(this),i=t.prop("name")||"files[]",r=(t.prop("files")||[1]).length;r;)n.push(i),r-=1}),n.length||(n=[i.prop("name")||"files[]"])),n},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,i,n){var r=e.Deferred(),o=r.promise();return i=i||this.options.context||o,t===!0?r.resolveWith(i,n):t===!1&&r.rejectWith(i,n),o.abort=r.promise,this._enhancePromise(o)},_addConvenienceMethods:function(t,i){var n=this,r=function(t){return e.Deferred().resolveWith(n,t).promise()};i.process=function(t,o){return(t||o)&&(i._processQueue=this._processQueue=(this._processQueue||r([this])).pipe(function(){return i.errorThrown?e.Deferred().rejectWith(n,[i]).promise():r(arguments)}).pipe(t,o)),this._processQueue||r([this])},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=n._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==!1&&n._onSend(t,this)),this.jqXHR||n._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",n._trigger("fail",null,this),n._getXHRPromise(!1))},i.state=function(){return this.jqXHR?n._getDeferredState(this.jqXHR):this._processQueue?n._getDeferredState(this._processQueue):void 0},i.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===n._getDeferredState(this._processQueue)},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),n=i&&i.length>1&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var n,r,o=this,a=t.files[0],s=a.size,l=t.uploadedBytes,p=t.maxChunkSize||s,u=this._blobSlice,d=e.Deferred(),c=d.promise();return this._isXHRUpload(t)&&u&&(l||s>p)&&!t.data?i?!0:l>=s?(a.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",a.error])):(r=function(){var i=e.extend({},t),c=i._progress.loaded;i.blob=u.call(a,l,l+p,a.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+l+"-"+(l+i.chunkSize-1)+"/"+s,o._initXHRData(i),o._initProgressListener(i),n=(o._trigger("chunksend",null,i)!==!1&&e.ajax(i)||o._getXHRPromise(!1,i.context)).done(function(n,a,p){l=o._getUploadedBytes(p)||l+i.chunkSize,c+i.chunkSize-i._progress.loaded&&o._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-i.uploadedBytes,total:l-i.uploadedBytes}),i),t.uploadedBytes=i.uploadedBytes=l,i.result=n,i.textStatus=a,i.jqXHR=p,o._trigger("chunkdone",null,i),o._trigger("chunkalways",null,i),s>l?r():d.resolveWith(i.context,[n,a,p])}).fail(function(e,t,n){i.jqXHR=e,i.textStatus=t,i.errorThrown=n,o._trigger("chunkfail",null,i),o._trigger("chunkalways",null,i),d.rejectWith(i.context,[e,t,n])})},this._enhancePromise(c),c.abort=function(){return n.abort()},r(),c):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,i,n,r){var o=r._progress.total,a=r._response;o>r._progress.loaded&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:o,total:o}),r),a.result=r.result=t,a.textStatus=r.textStatus=i,a.jqXHR=r.jqXHR=n,this._trigger("done",null,r)},_onFail:function(e,t,i,n){var r=n._response;n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total),r.jqXHR=n.jqXHR=e,r.textStatus=n.textStatus=t,r.errorThrown=n.errorThrown=i,this._trigger("fail",null,n)},_onAlways:function(e,t,i,n){this._trigger("always",null,n)},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var n,r,o,a,s=this,l=s._getAJAXSettings(i),p=function(){return s._sending+=1,l._bitrateTimer=new s._BitrateTimer,n=n||((r||s._trigger("send",e.Event("send",{delegatedEvent:t}),l)===!1)&&s._getXHRPromise(!1,l.context,r)||s._chunkedUpload(l)||e.ajax(l)).done(function(e,t,i){s._onDone(e,t,i,l)}).fail(function(e,t,i){s._onFail(e,t,i,l)}).always(function(e,t,i){if(s._onAlways(e,t,i,l),s._sending-=1,s._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>s._sending)for(var n=s._slots.shift();n;){if("pending"===s._getDeferredState(n)){n.resolve();break}n=s._slots.shift()}0===s._active&&s._trigger("stop")})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=e.Deferred(),this._slots.push(o),a=o.pipe(p)):(this._sequence=this._sequence.pipe(p,p),a=this._sequence),a.abort=function(){return r=[void 0,"abort","abort"],n?n.abort():(o&&o.rejectWith(l.context,r),p())},this._enhancePromise(a)):p()},_onAdd:function(t,i){var n,r,o,a,s=this,l=!0,p=e.extend({},this.options,i),u=i.files,d=u.length,c=p.limitMultiFileUploads,h=p.limitMultiFileUploadSize,f=p.limitMultiFileUploadSizeOverhead,g=0,m=this._getParamName(p),_=0;if(!h||d&&void 0!==u[0].size||(h=void 0),(p.singleFileUploads||c||h)&&this._isXHRUpload(p))if(p.singleFileUploads||h||!c)if(!p.singleFileUploads&&h)for(o=[],n=[],a=0;d>a;a+=1)g+=u[a].size+f,(a+1===d||g+u[a+1].size+f>h||c&&a+1-_>=c)&&(o.push(u.slice(_,a+1)),r=m.slice(_,a+1),r.length||(r=m),n.push(r),_=a+1,g=0);else n=m;else for(o=[],n=[],a=0;d>a;a+=c)o.push(u.slice(a,a+c)),r=m.slice(a,a+c),r.length||(r=m),n.push(r);else o=[u],n=[m];return i.originalFiles=u,e.each(o||u,function(r,a){var p=e.extend({},i);return p.files=o?a:[a],p.paramName=n[r],s._initResponseObject(p),s._initProgressObject(p),s._addConvenienceMethods(t,p),l=s._trigger("add",e.Event("add",{delegatedEvent:t}),p)}),l},_replaceFileInput:function(t){var i=t.clone(!0);e("<form></form>").append(i)[0].reset(),t.after(i).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,n){return n===t[0]?i[0]:n}),t[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(t,i){var n,r=this,o=e.Deferred(),a=function(e){e&&!e.entry&&(e.entry=t),o.resolve([e])};return i=i||"",t.isFile?t._file?(t._file.relativePath=i,o.resolve(t._file)):t.file(function(e){e.relativePath=i,o.resolve(e)},a):t.isDirectory?(n=t.createReader(),n.readEntries(function(e){r._handleFileTreeEntries(e,i+t.name+"/").done(function(e){o.resolve(e)}).fail(a)},a)):o.resolve([]),o.promise()},_handleFileTreeEntries:function(t,i){var n=this;return e.when.apply(e,e.map(t,function(e){return n._handleFileTreeEntry(e,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(e.map(i,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var i,n,r=t.prop("webkitEntries")||t.prop("entries");if(r&&r.length)return this._handleFileTreeEntries(r);if(i=e.makeArray(t.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&e.each(i,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(n=t.prop("value"),!n)return e.Deferred().resolve([]).promise();i=[{name:n.replace(/^.*\\/,"")}]}return e.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)
}):this._getSingleFileInputFiles(t)},_onChange:function(t){var i=this,n={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(n.fileInput).always(function(r){n.files=r,i.options.replaceFileInput&&i._replaceFileInput(n.fileInput),i._trigger("change",e.Event("change",{delegatedEvent:t}),n)!==!1&&i._onAdd(t,n)})},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,n={files:[]};i&&i.length&&(e.each(i,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&n.files.push(i)}),this._trigger("paste",e.Event("paste",{delegatedEvent:t}),n)!==!1&&this._onAdd(t,n))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=this,n=t.dataTransfer,r={};n&&n.files&&n.files.length&&(t.preventDefault(),this._getDroppedFiles(n).always(function(n){r.files=n,i._trigger("drop",e.Event("drop",{delegatedEvent:t}),r)!==!1&&i._onAdd(t,r)}))},_onDragOver:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=t.dataTransfer;i&&-1!==e.inArray("Files",i.types)&&this._trigger("dragover",e.Event("dragover",{delegatedEvent:t}))!==!1&&(t.preventDefault(),i.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,i){var n=-1!==e.inArray(t,this._specialOptions);n&&this._destroyEventHandlers(),this._super(t,i),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return"url"!==t&&"string"===e.type(i)&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options;e.each(e(this.element[0].cloneNode(!1)).data(),function(e,n){t._isRegExpOption(e,n)&&(n=t._getRegExp(n)),i[e]=n})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,n,r=this,o=e.Deferred(),a=o.promise();return a.abort=function(){return n=!0,i?i.abort():(o.reject(null,"abort","abort"),a)},this._getFileInputFiles(t.fileInput).always(function(e){if(!n){if(!e.length)return o.reject(),void 0;t.files=e,i=r._onSend(null,t).then(function(e,t,i){o.resolve(e,t,i)},function(e,t,i){o.reject(e,t,i)})}}),this._enhancePromise(a)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});